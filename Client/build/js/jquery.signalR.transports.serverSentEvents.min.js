!function(e,t,n){"use strict";var r=e.signalR,o=e.signalR.events,c=e.signalR.changeState,i=r.transports._logic,a=function(e){t.clearTimeout(e._.reconnectAttemptTimeoutHandle),delete e._.reconnectAttemptTimeoutHandle};r.transports.serverSentEvents={name:"serverSentEvents",supportsKeepAlive:function(){return!0},timeOut:3e3,start:function(n,s,u){var v,l=this,d=!1,S=e(n),g=!s;if(n.eventSource&&(n.log("The connection already has an event source. Stopping it."),n.stop()),!t.EventSource)return void(u&&(n.log("This browser doesn't support SSE."),u()));v=i.getUrl(n,this.name,g);try{n.log("Attempting to connect to SSE endpoint '"+v+"'."),n.eventSource=new t.EventSource(v,{withCredentials:n.withCredentials})}catch(e){return n.log("EventSource failed trying to connect with error "+e.Message+"."),void(u?u():(S.triggerHandler(o.onError,[r._.transportError(r.resources.eventSourceFailedToConnect,n.transport,e)]),g&&l.reconnect(n)))}g&&(n._.reconnectAttemptTimeoutHandle=t.setTimeout(function(){d===!1&&n.eventSource.readyState!==t.EventSource.OPEN&&l.reconnect(n)},l.timeOut)),n.eventSource.addEventListener("open",function(e){n.log("EventSource connected."),a(n),i.clearReconnectTimeout(n),d===!1&&(d=!0,c(n,r.connectionState.reconnecting,r.connectionState.connected)===!0&&S.triggerHandler(o.onReconnect))},!1),n.eventSource.addEventListener("message",function(e){var t;if("initialized"!==e.data){try{t=n._parseResponse(e.data)}catch(t){return void i.handleParseFailure(n,e.data,t,u,e)}i.processMessages(n,t,s)}},!1),n.eventSource.addEventListener("error",function(e){var c=r._.transportError(r.resources.eventSourceError,n.transport,e);this===n.eventSource&&(u&&u(c)||(n.log("EventSource readyState: "+n.eventSource.readyState+"."),e.eventPhase===t.EventSource.CLOSED?(n.log("EventSource reconnecting due to the server connection ending."),l.reconnect(n)):(n.log("EventSource error."),S.triggerHandler(o.onError,[c]))))},!1)},reconnect:function(e){i.reconnect(e,this.name)},lostConnection:function(e){this.reconnect(e)},send:function(e,t){i.ajaxSend(e,t)},stop:function(e){a(e),i.clearReconnectTimeout(e),e&&e.eventSource&&(e.log("EventSource calling close()."),e.eventSource.close(),e.eventSource=null,delete e.eventSource)},abort:function(e,t){i.ajaxAbort(e,t)}}}(window.jQuery,window);