!function(e,t,n){"use strict";function r(e){e._.keepAliveData.monitoring&&o(e),s.markActive(e)&&(e._.beatHandle=t.setTimeout(function(){r(e)},e._.beatInterval))}function o(t){var n,r=t._.keepAliveData;t.state===c.connectionState.connected&&(n=(new Date).getTime()-t._.lastMessageAt,n>=r.timeout?(t.log("Keep alive timed out.  Notifying transport that connection has been lost."),t.transport.lostConnection(t)):n>=r.timeoutWarning?r.userNotified||(t.log("Keep alive has been missed, connection may be dead/slow."),e(t).triggerHandler(u.onConnectionSlow),r.userNotified=!0):r.userNotified=!1)}function i(e,t){var n=e.url+t;return e.transport&&(n+="?transport="+e.transport.name),s.prepareQueryString(e,n)}function a(e){this.connection=e,this.startRequested=!1,this.startCompleted=!1,this.connectionStopped=!1}var s,c=e.signalR,u=e.signalR.events,p=e.signalR.changeState,d="__Start Aborted__";c.transports={},a.prototype={start:function(e,r,o){var i=this,a=i.connection,s=!1;return i.startRequested||i.connectionStopped?void a.log("WARNING! "+e.name+" transport cannot be started. Initialization ongoing or completed."):(a.log(e.name+" transport starting."),e.start(a,function(){s||i.initReceived(e,r)},function(t){return s||(s=!0,i.transportFailed(e,t,o)),!i.startCompleted||i.connectionStopped}),void(i.transportTimeoutHandle=t.setTimeout(function(){s||(s=!0,a.log(e.name+" transport timed out when trying to connect."),i.transportFailed(e,n,o))},a._.totalTransportConnectTimeout)))},stop:function(){this.connectionStopped=!0,t.clearTimeout(this.transportTimeoutHandle),c.transports._logic.tryAbortStartRequest(this.connection)},initReceived:function(e,n){var r=this,o=r.connection;return r.startRequested?void o.log("WARNING! The client received multiple init messages."):void(r.connectionStopped||(r.startRequested=!0,t.clearTimeout(r.transportTimeoutHandle),o.log(e.name+" transport connected. Initiating start request."),c.transports._logic.ajaxStart(o,function(){r.startCompleted=!0,n()})))},transportFailed:function(n,r,o){var i,a=this.connection,s=a._deferral;this.connectionStopped||(t.clearTimeout(this.transportTimeoutHandle),this.startRequested?this.startCompleted||(i=c._.error(c.resources.errorDuringStartRequest,r),a.log(n.name+" transport failed during the start request. Stopping the connection."),e(a).triggerHandler(u.onError,[i]),s&&s.reject(i),a.stop()):(n.stop(a),a.log(n.name+" transport failed to connect. Attempting to fall back."),o()))}},s=c.transports._logic={ajax:function(t,n){return e.ajax(e.extend(!0,{},e.signalR.ajaxDefaults,{type:"GET",data:{},xhrFields:{withCredentials:t.withCredentials},contentType:t.contentType,dataType:t.ajaxDataType},n))},pingServer:function(t){var n,r,o=e.Deferred();return t.transport?(n=t.url+"/ping",n=s.addQs(n,t.qs),r=s.ajax(t,{url:n,success:function(e){var n;try{n=t._parseResponse(e)}catch(e){return o.reject(c._.transportError(c.resources.pingServerFailedParse,t.transport,e,r)),void t.stop()}"pong"===n.Response?o.resolve():o.reject(c._.transportError(c._.format(c.resources.pingServerFailedInvalidResponse,e),t.transport,null,r))},error:function(e){401===e.status||403===e.status?(o.reject(c._.transportError(c._.format(c.resources.pingServerFailedStatusCode,e.status),t.transport,e,r)),t.stop()):o.reject(c._.transportError(c.resources.pingServerFailed,t.transport,e,r))}})):o.reject(c._.transportError(c.resources.noConnectionTransport,t.transport)),o.promise()},prepareQueryString:function(e,n){var r;return r=s.addQs(n,"clientProtocol="+e.clientProtocol),r=s.addQs(r,e.qs),e.token&&(r+="&connectionToken="+t.encodeURIComponent(e.token)),e.data&&(r+="&connectionData="+t.encodeURIComponent(e.data)),r},addQs:function(t,n){var r,o=t.indexOf("?")!==-1?"&":"?";if(!n)return t;if("object"==typeof n)return t+o+e.param(n);if("string"==typeof n)return r=n.charAt(0),"?"!==r&&"&"!==r||(o=""),t+o+n;throw new Error("Query string property must be either a string or object.")},getUrl:function(e,n,r,o,i){var a="webSockets"===n?"":e.baseUrl,c=a+e.appRelativeUrl,u="transport="+n;return!i&&e.groupsToken&&(u+="&groupsToken="+t.encodeURIComponent(e.groupsToken)),r?(c+=o?"/poll":"/reconnect",!i&&e.messageId&&(u+="&messageId="+t.encodeURIComponent(e.messageId))):c+="/connect",c+="?"+u,c=s.prepareQueryString(e,c),i||(c+="&tid="+Math.floor(11*Math.random())),c},maximizePersistentResponse:function(e){return{MessageId:e.C,Messages:e.M,Initialized:"undefined"!=typeof e.S,ShouldReconnect:"undefined"!=typeof e.T,LongPollDelay:e.L,GroupsToken:e.G}},updateGroups:function(e,t){t&&(e.groupsToken=t)},stringifySend:function(e,t){return"string"==typeof t||"undefined"==typeof t||null===t?t:e.json.stringify(t)},ajaxSend:function(t,n){var r,o=s.stringifySend(t,n),a=i(t,"/send"),p=function(t,o){e(o).triggerHandler(u.onError,[c._.transportError(c.resources.sendFailed,o.transport,t,r),n])};return r=s.ajax(t,{url:a,type:"jsonp"===t.ajaxDataType?"GET":"POST",contentType:c._.defaultContentType,data:{data:o},success:function(e){var n;if(e){try{n=t._parseResponse(e)}catch(e){return p(e,t),void t.stop()}s.triggerReceived(t,n)}},error:function(e,n){"abort"!==n&&"parsererror"!==n&&p(e,t)}})},ajaxAbort:function(e,t){if("undefined"!=typeof e.transport){t="undefined"==typeof t||t;var n=i(e,"/abort");s.ajax(e,{url:n,async:t,timeout:1e3,type:"POST"}),e.log("Fired ajax abort async = "+t+".")}},ajaxStart:function(t,n){var r=function(e){var n=t._deferral;n&&n.reject(e)},o=function(n){t.log("The start request failed. Stopping the connection."),e(t).triggerHandler(u.onError,[n]),r(n),t.stop()};t._.startRequest=s.ajax(t,{url:i(t,"/start"),success:function(e,r,i){var a;try{a=t._parseResponse(e)}catch(t){return void o(c._.error(c._.format(c.resources.errorParsingStartResponse,e),t,i))}"started"===a.Response?n():o(c._.error(c._.format(c.resources.invalidStartResponse,e),null,i))},error:function(e,n,i){n!==d?o(c._.error(c.resources.errorDuringStartRequest,i,e)):(t.log("The start request aborted because connection.stop() was called."),r(c._.error(c.resources.stoppedDuringStartRequest,null,e)))}})},tryAbortStartRequest:function(e){e._.startRequest&&(e._.startRequest.abort(d),delete e._.startRequest)},tryInitialize:function(e,t,n){t.Initialized&&n?n():t.Initialized&&e.log("WARNING! The client received an init message after reconnecting.")},triggerReceived:function(t,n){t._.connectingMessageBuffer.tryBuffer(n)||e(t).triggerHandler(u.onReceived,[n])},processMessages:function(t,n,r){var o;s.markLastMessage(t),n&&(o=s.maximizePersistentResponse(n),s.updateGroups(t,o.GroupsToken),o.MessageId&&(t.messageId=o.MessageId),o.Messages&&(e.each(o.Messages,function(e,n){s.triggerReceived(t,n)}),s.tryInitialize(t,o,r)))},monitorKeepAlive:function(t){var n=t._.keepAliveData;n.monitoring?t.log("Tried to monitor keep alive but it's already being monitored."):(n.monitoring=!0,s.markLastMessage(t),t._.keepAliveData.reconnectKeepAliveUpdate=function(){s.markLastMessage(t)},e(t).bind(u.onReconnect,t._.keepAliveData.reconnectKeepAliveUpdate),t.log("Now monitoring keep alive with a warning timeout of "+n.timeoutWarning+", keep alive timeout of "+n.timeout+" and disconnecting timeout of "+t.disconnectTimeout))},stopMonitoringKeepAlive:function(t){var n=t._.keepAliveData;n.monitoring&&(n.monitoring=!1,e(t).unbind(u.onReconnect,t._.keepAliveData.reconnectKeepAliveUpdate),t._.keepAliveData={},t.log("Stopping the monitoring of the keep alive."))},startHeartbeat:function(e){e._.lastActiveAt=(new Date).getTime(),r(e)},markLastMessage:function(e){e._.lastMessageAt=(new Date).getTime()},markActive:function(e){return!!s.verifyLastActive(e)&&(e._.lastActiveAt=(new Date).getTime(),!0)},isConnectedOrReconnecting:function(e){return e.state===c.connectionState.connected||e.state===c.connectionState.reconnecting},ensureReconnectingState:function(t){return p(t,c.connectionState.connected,c.connectionState.reconnecting)===!0&&e(t).triggerHandler(u.onReconnecting),t.state===c.connectionState.reconnecting},clearReconnectTimeout:function(e){e&&e._.reconnectTimeout&&(t.clearTimeout(e._.reconnectTimeout),delete e._.reconnectTimeout)},verifyLastActive:function(t){if((new Date).getTime()-t._.lastActiveAt>=t.reconnectWindow){var n=c._.format(c.resources.reconnectWindowTimeout,new Date(t._.lastActiveAt),t.reconnectWindow);return t.log(n),e(t).triggerHandler(u.onError,[c._.error(n,"TimeoutException")]),t.stop(!1,!1),!1}return!0},reconnect:function(e,n){var r=c.transports[n];if(s.isConnectedOrReconnecting(e)&&!e._.reconnectTimeout){if(!s.verifyLastActive(e))return;e._.reconnectTimeout=t.setTimeout(function(){s.verifyLastActive(e)&&(r.stop(e),s.ensureReconnectingState(e)&&(e.log(n+" reconnecting."),r.start(e)))},e.reconnectDelay)}},handleParseFailure:function(t,n,r,o,i){var a=c._.transportError(c._.format(c.resources.parseFailed,n),t.transport,r,i);o&&o(a)?t.log("Failed to parse server response while attempting to connect."):(e(t).triggerHandler(u.onError,[a]),t.stop())},initHandler:function(e){return new a(e)},foreverFrame:{count:0,connections:{}}}}(window.jQuery,window);