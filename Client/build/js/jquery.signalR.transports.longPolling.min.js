!function(e,n,o){"use strict";var t=e.signalR,r=e.signalR.events,l=e.signalR.changeState,i=e.signalR.isDisconnecting,c=t.transports._logic;t.transports.longPolling={name:"longPolling",supportsKeepAlive:function(){return!1},reconnectDelay:3e3,start:function(o,s,a){var u=this,g=function(){g=e.noop,o.log("LongPolling connected."),s?s():o.log("WARNING! The client received an init message after reconnecting.")},p=function(e){return!!a(e)&&(o.log("LongPolling failed to connect."),!0)},d=o._,m=0,T=function(o){n.clearTimeout(d.reconnectTimeoutId),d.reconnectTimeoutId=null,l(o,t.connectionState.reconnecting,t.connectionState.connected)===!0&&(o.log("Raising the reconnect event"),e(o).triggerHandler(r.onReconnect))},f=36e5;o.pollXhr&&(o.log("Polling xhr requests already exists, aborting."),o.stop()),o.messageId=null,d.reconnectTimeoutId=null,d.pollTimeoutId=n.setTimeout(function(){!function l(s,a){var h=s.messageId,I=null===h,v=!I,R=!a,y=c.getUrl(s,u.name,v,R,!0),P={};s.messageId&&(P.messageId=s.messageId),s.groupsToken&&(P.groupsToken=s.groupsToken),i(s)!==!0&&(o.log("Opening long polling request to '"+y+"'."),s.pollXhr=c.ajax(o,{xhrFields:{onprogress:function(){c.markLastMessage(o)}},url:y,type:"POST",contentType:t._.defaultContentType,data:P,timeout:o._.pollTimeout,success:function(t){var r,a,u,f=0;o.log("Long poll complete."),m=0;try{r=o._parseResponse(t)}catch(e){return void c.handleParseFailure(s,t,e,p,s.pollXhr)}null!==d.reconnectTimeoutId&&T(s),r&&(a=c.maximizePersistentResponse(r)),c.processMessages(s,r,g),a&&"number"===e.type(a.LongPollDelay)&&(f=a.LongPollDelay),i(s)!==!0&&(u=a&&a.ShouldReconnect,u&&!c.ensureReconnectingState(s)||(f>0?d.pollTimeoutId=n.setTimeout(function(){l(s,u)},f):l(s,u)))},error:function(i,a){var g=t._.transportError(t.resources.longPollFailed,o.transport,i,s.pollXhr);if(n.clearTimeout(d.reconnectTimeoutId),d.reconnectTimeoutId=null,"abort"===a)return void o.log("Aborted xhr request.");if(!p(g)){if(m++,o.state!==t.connectionState.reconnecting&&(o.log("An error occurred using longPolling. Status = "+a+".  Response = "+i.responseText+"."),e(s).triggerHandler(r.onError,[g])),(o.state===t.connectionState.connected||o.state===t.connectionState.reconnecting)&&!c.verifyLastActive(o))return;if(!c.ensureReconnectingState(s))return;d.pollTimeoutId=n.setTimeout(function(){l(s,!0)},u.reconnectDelay)}}}),v&&a===!0&&(d.reconnectTimeoutId=n.setTimeout(function(){T(s)},Math.min(1e3*(Math.pow(2,m)-1),f))))}(o)},250)},lostConnection:function(e){e.pollXhr&&e.pollXhr.abort("lostConnection")},send:function(e,n){c.ajaxSend(e,n)},stop:function(e){n.clearTimeout(e._.pollTimeoutId),n.clearTimeout(e._.reconnectTimeoutId),delete e._.pollTimeoutId,delete e._.reconnectTimeoutId,e.pollXhr&&(e.pollXhr.abort(),e.pollXhr=null,delete e.pollXhr)},abort:function(e,n){c.ajaxAbort(e,n)}}}(window.jQuery,window);